# ä»£ç è´¨é‡æ”¹è¿›å»ºè®®

> åŸºäºé¡¹ç›®åˆ†æå’Œæ„å»ºè¿‡ç¨‹ä¸­å‘ç°çš„é—®é¢˜ï¼Œæä¾›å…¨é¢çš„ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§æ”¹è¿›å»ºè®®

## ğŸš¨ å½“å‰å·²ä¿®å¤çš„é—®é¢˜

### 1. Sass Loader é…ç½®é”™è¯¯
**é—®é¢˜**ï¼š`vue.config.js` ä¸­ä½¿ç”¨äº†å·²å¼ƒç”¨çš„ `additionalData` é…ç½®
**ä¿®å¤**ï¼šæ›´æ”¹ä¸º `prependData` é…ç½®
**å½±å“**ï¼šè§£å†³äº†å°ç¨‹åºæ„å»ºå¤±è´¥çš„é—®é¢˜

## âš ï¸ å½“å‰è­¦å‘Šå’Œå»ºè®®ä¿®å¤

### 1. Sass å¼ƒç”¨è­¦å‘Š
**è­¦å‘Šä¿¡æ¯**ï¼š
- `The legacy JS API is deprecated and will be removed in Dart Sass 2.0.0`
- `Sass @import rules are deprecated and will be removed in Dart Sass 3.0.0`

**å»ºè®®ä¿®å¤**ï¼š
```scss
// æ›¿æ¢ @import ä¸º @use
// æ—§å†™æ³•ï¼š@import "@/uni.scss";
// æ–°å†™æ³•ï¼š@use "@/uni.scss";
```

### 2. API å¯¼å‡ºå‡½æ•°ç¼ºå¤±
**è­¦å‘Šä¿¡æ¯**ï¼š`export 'recordStudyData' was not found in '@/api/study'`
**ä½ç½®**ï¼š`src/pages/exam/exam.vue`
**å»ºè®®ä¿®å¤**ï¼šåœ¨ `@/api/study.js` ä¸­æ·»åŠ ç¼ºå¤±çš„ `recordStudyData` å‡½æ•°

## ğŸ”§ ä»£ç è´¨é‡æ”¹è¿›å»ºè®®

### 1. é¡¹ç›®ç»“æ„ä¼˜åŒ–

#### å½“å‰ç»“æ„é—®é¢˜ï¼š
- é…ç½®æ–‡ä»¶åˆ†æ•£åœ¨ä¸åŒä½ç½®
- ç¯å¢ƒå˜é‡ç®¡ç†ä¸å¤Ÿç»Ÿä¸€
- ç¼ºå°‘ç»Ÿä¸€çš„å¸¸é‡ç®¡ç†

#### å»ºè®®æ”¹è¿›ï¼š
```
src/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ index.js          # ç»Ÿä¸€é…ç½®å…¥å£
â”‚   â”œâ”€â”€ api.js            # API é…ç½®
â”‚   â”œâ”€â”€ constants.js      # å¸¸é‡å®šä¹‰
â”‚   â””â”€â”€ env.js            # ç¯å¢ƒå˜é‡å¤„ç†
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ request.js        # ç½‘ç»œè¯·æ±‚å°è£…
â”‚   â”œâ”€â”€ storage.js        # æœ¬åœ°å­˜å‚¨å°è£…
â”‚   â”œâ”€â”€ validator.js      # æ•°æ®éªŒè¯å·¥å…·
â”‚   â””â”€â”€ formatter.js      # æ•°æ®æ ¼å¼åŒ–å·¥å…·
â”œâ”€â”€ composables/          # Vue 3 ç»„åˆå¼å‡½æ•°
â”‚   â”œâ”€â”€ useAuth.js        # è®¤è¯ç›¸å…³
â”‚   â”œâ”€â”€ useQuestion.js    # é¢˜ç›®ç›¸å…³
â”‚   â””â”€â”€ useStudy.js       # å­¦ä¹ è®°å½•ç›¸å…³
â””â”€â”€ types/                # TypeScript ç±»å‹å®šä¹‰
    â”œâ”€â”€ api.ts
    â”œâ”€â”€ user.ts
    â””â”€â”€ question.ts
```

### 2. é”™è¯¯å¤„ç†æ”¹è¿›

#### å½“å‰é—®é¢˜ï¼š
- é”™è¯¯å¤„ç†ä¸å¤Ÿç»Ÿä¸€
- ç¼ºå°‘å…¨å±€é”™è¯¯å¤„ç†æœºåˆ¶
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤ºä¸è¶³

#### å»ºè®®æ”¹è¿›ï¼š
```javascript
// utils/errorHandler.js
export class ErrorHandler {
  static handle(error, context = '') {
    console.error(`[${context}] Error:`, error)
    
    // æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒæç¤º
    if (error.code === 'NETWORK_ERROR') {
      uni.showToast({
        title: 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®',
        icon: 'none'
      })
    } else if (error.code === 401) {
      // å¤„ç†ç™»å½•è¿‡æœŸ
      this.handleAuthError()
    } else {
      uni.showToast({
        title: error.message || 'æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•',
        icon: 'none'
      })
    }
  }
  
  static handleAuthError() {
    uni.removeStorageSync('token')
    uni.reLaunch({
      url: '/pages/auth/login'
    })
  }
}
```

### 3. æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### å›¾ç‰‡ä¼˜åŒ–ï¼š
```javascript
// vue.config.js ä¸­çš„å›¾ç‰‡å‹ç¼©é…ç½®å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–
chainWebpack: config => {
  // æ·»åŠ  WebP æ”¯æŒ
  config.module
    .rule('images')
    .test(/\.(png|jpe?g|gif|svg)$/)
    .use('url-loader')
    .loader('url-loader')
    .options({
      limit: 8192,
      name: 'img/[name].[hash:8].[ext]',
      // å°äº 8KB çš„å›¾ç‰‡è½¬ä¸º base64
      fallback: {
        loader: 'file-loader',
        options: {
          name: 'img/[name].[hash:8].[ext]'
        }
      }
    })
}
```

#### ä»£ç åˆ†å‰²ä¼˜åŒ–ï¼š
```javascript
// è·¯ç”±æ‡’åŠ è½½
const routes = [
  {
    path: '/pages/question/detail',
    component: () => import('@/pages/question/detail.vue')
  }
]

// ç»„ä»¶æ‡’åŠ è½½
export default {
  components: {
    QuestionCard: () => import('@/components/QuestionCard.vue')
  }
}
```

### 4. ä»£ç è§„èŒƒæ”¹è¿›

#### ESLint é…ç½®ä¼˜åŒ–ï¼š
```javascript
// .eslintrc.js
module.exports = {
  extends: [
    '@vue/standard',
    '@vue/typescript/recommended'
  ],
  rules: {
    // å¼ºåˆ¶ä½¿ç”¨ const/let è€Œä¸æ˜¯ var
    'no-var': 'error',
    // å¼ºåˆ¶ä½¿ç”¨ === è€Œä¸æ˜¯ ==
    'eqeqeq': 'error',
    // ç¦æ­¢ console.logï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
    'no-console': process.env.NODE_ENV === 'production' ? 'error' : 'warn',
    // Vue ç‰¹å®šè§„åˆ™
    'vue/component-name-in-template-casing': ['error', 'PascalCase'],
    'vue/no-unused-vars': 'error'
  }
}
```

#### Prettier é…ç½®ï¼š
```json
// .prettierrc
{
  "semi": false,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "none",
  "printWidth": 80,
  "bracketSpacing": true,
  "arrowParens": "avoid"
}
```

### 5. æµ‹è¯•è¦†ç›–ç‡æ”¹è¿›

#### å•å…ƒæµ‹è¯•å»ºè®®ï¼š
```javascript
// tests/unit/utils/request.spec.js
import { request } from '@/utils/request'
import { ERROR_CODES } from '@/config'

describe('Request Utils', () => {
  test('should handle network error', async () => {
    // Mock ç½‘ç»œé”™è¯¯
    const mockError = new Error('Network Error')
    mockError.code = ERROR_CODES.NETWORK_ERROR
    
    // æµ‹è¯•é”™è¯¯å¤„ç†
    await expect(request.get('/api/test')).rejects.toThrow()
  })
  
  test('should add auth token to headers', () => {
    // æµ‹è¯•è®¤è¯å¤´æ·»åŠ 
    const config = request.interceptors.request.use()
    expect(config.headers.Authorization).toBeDefined()
  })
})
```

#### E2E æµ‹è¯•å»ºè®®ï¼š
```javascript
// cypress/e2e/user-flow.cy.js
describe('ç”¨æˆ·å®Œæ•´æµç¨‹æµ‹è¯•', () => {
  it('ç”¨æˆ·å¯ä»¥å®Œæˆæ³¨å†Œ-ç™»å½•-ç­”é¢˜-æŸ¥çœ‹è®°å½•çš„å®Œæ•´æµç¨‹', () => {
    // æ³¨å†Œ
    cy.visit('/pages/auth/register')
    cy.get('[data-cy=username]').type('testuser')
    cy.get('[data-cy=password]').type('password123')
    cy.get('[data-cy=register-btn]').click()
    
    // ç™»å½•
    cy.url().should('include', '/pages/auth/login')
    cy.get('[data-cy=login-btn]').click()
    
    // ç­”é¢˜
    cy.visit('/pages/question/list')
    cy.get('[data-cy=question-item]').first().click()
    cy.get('[data-cy=answer-option]').first().click()
    cy.get('[data-cy=submit-btn]').click()
    
    // æŸ¥çœ‹è®°å½•
    cy.visit('/pages/study/record')
    cy.get('[data-cy=study-record]').should('be.visible')
  })
})
```

### 6. å®‰å…¨æ€§æ”¹è¿›

#### è¾“å…¥éªŒè¯ï¼š
```javascript
// utils/validator.js
export const validators = {
  email: (value) => {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    return emailRegex.test(value)
  },
  
  password: (value) => {
    // è‡³å°‘8ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—
    const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/
    return passwordRegex.test(value)
  },
  
  // XSS é˜²æŠ¤
  sanitizeHtml: (html) => {
    return html
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#x27;')
  }
}
```

#### æ•æ„Ÿä¿¡æ¯ä¿æŠ¤ï¼š
```javascript
// utils/security.js
export class Security {
  // åŠ å¯†å­˜å‚¨æ•æ„Ÿä¿¡æ¯
  static encryptStorage(key, value) {
    const encrypted = btoa(JSON.stringify(value))
    uni.setStorageSync(key, encrypted)
  }
  
  // è§£å¯†è¯»å–æ•æ„Ÿä¿¡æ¯
  static decryptStorage(key) {
    try {
      const encrypted = uni.getStorageSync(key)
      return JSON.parse(atob(encrypted))
    } catch (error) {
      console.error('è§£å¯†å¤±è´¥:', error)
      return null
    }
  }
  
  // æ¸…ç†æ•æ„Ÿä¿¡æ¯
  static clearSensitiveData() {
    const sensitiveKeys = ['token', 'userInfo', 'password']
    sensitiveKeys.forEach(key => {
      uni.removeStorageSync(key)
    })
  }
}
```

### 7. å¯ç»´æŠ¤æ€§æ”¹è¿›

#### ç»„ä»¶è®¾è®¡åŸåˆ™ï¼š
```vue
<!-- å¥½çš„ç»„ä»¶è®¾è®¡ç¤ºä¾‹ -->
<template>
  <view class="question-card">
    <view class="question-title">{{ question.title }}</view>
    <view class="question-options">
      <view 
        v-for="(option, index) in question.options" 
        :key="index"
        class="option-item"
        :class="{ active: selectedOption === index }"
        @click="selectOption(index)"
      >
        {{ option }}
      </view>
    </view>
  </view>
</template>

<script>
export default {
  name: 'QuestionCard',
  props: {
    question: {
      type: Object,
      required: true,
      validator: (value) => {
        return value && value.title && Array.isArray(value.options)
      }
    }
  },
  emits: ['answer-selected'],
  data() {
    return {
      selectedOption: null
    }
  },
  methods: {
    selectOption(index) {
      this.selectedOption = index
      this.$emit('answer-selected', {
        questionId: this.question.id,
        selectedOption: index,
        answer: this.question.options[index]
      })
    }
  }
}
</script>
```

#### çŠ¶æ€ç®¡ç†æ”¹è¿›ï¼š
```javascript
// store/modules/question.js
export default {
  namespaced: true,
  state: {
    questions: [],
    currentQuestion: null,
    loading: false,
    error: null
  },
  
  mutations: {
    SET_LOADING(state, loading) {
      state.loading = loading
    },
    SET_QUESTIONS(state, questions) {
      state.questions = questions
    },
    SET_ERROR(state, error) {
      state.error = error
    }
  },
  
  actions: {
    async fetchQuestions({ commit }, params) {
      commit('SET_LOADING', true)
      try {
        const response = await questionAPI.getQuestions(params)
        commit('SET_QUESTIONS', response.data)
      } catch (error) {
        commit('SET_ERROR', error.message)
        throw error
      } finally {
        commit('SET_LOADING', false)
      }
    }
  },
  
  getters: {
    questionsByCategory: (state) => (category) => {
      return state.questions.filter(q => q.category === category)
    },
    
    completedQuestions: (state) => {
      return state.questions.filter(q => q.completed)
    }
  }
}
```

## ğŸ“Š ç›‘æ§å’Œåˆ†æå»ºè®®

### 1. æ€§èƒ½ç›‘æ§
```javascript
// utils/performance.js
export class PerformanceMonitor {
  static measurePageLoad(pageName) {
    const startTime = Date.now()
    
    return {
      end: () => {
        const loadTime = Date.now() - startTime
        console.log(`é¡µé¢ ${pageName} åŠ è½½æ—¶é—´: ${loadTime}ms`)
        
        // å‘é€åˆ°åˆ†ææœåŠ¡
        this.sendMetrics({
          type: 'page_load',
          page: pageName,
          duration: loadTime
        })
      }
    }
  }
  
  static sendMetrics(data) {
    // å‘é€æ€§èƒ½æ•°æ®åˆ°åˆ†æå¹³å°
    if (process.env.NODE_ENV === 'production') {
      // å®é™…çš„æ•°æ®ä¸ŠæŠ¥é€»è¾‘
    }
  }
}
```

### 2. é”™è¯¯ç›‘æ§
```javascript
// utils/errorReporting.js
export class ErrorReporting {
  static init() {
    // å…¨å±€é”™è¯¯æ•è·
    uni.onError((error) => {
      this.reportError(error, 'global')
    })
    
    // Promise é”™è¯¯æ•è·
    uni.onUnhandledRejection((event) => {
      this.reportError(event.reason, 'promise')
    })
  }
  
  static reportError(error, type) {
    const errorInfo = {
      message: error.message,
      stack: error.stack,
      type,
      timestamp: new Date().toISOString(),
      userAgent: uni.getSystemInfoSync(),
      url: getCurrentPages().pop()?.route
    }
    
    // å‘é€é”™è¯¯æŠ¥å‘Š
    if (process.env.NODE_ENV === 'production') {
      // å®é™…çš„é”™è¯¯ä¸ŠæŠ¥é€»è¾‘
    }
  }
}
```

## ğŸš€ éƒ¨ç½²å’Œ CI/CD æ”¹è¿›

### 1. GitHub Actions é…ç½®
```yaml
# .github/workflows/deploy.yml
name: Deploy Mini Program

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run tests
      run: npm run test
    
    - name: Run linting
      run: npm run lint
    
    - name: Build project
      run: npm run build:mp-weixin
    
    - name: Upload build artifacts
      uses: actions/upload-artifact@v3
      with:
        name: miniprogram-build
        path: dist/build/mp-weixin
```

### 2. è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
```bash
#!/bin/bash
# scripts/deploy.sh

set -e

echo "å¼€å§‹éƒ¨ç½²å°ç¨‹åº..."

# å®‰è£…ä¾èµ–
echo "å®‰è£…ä¾èµ–..."
npm ci

# è¿è¡Œæµ‹è¯•
echo "è¿è¡Œæµ‹è¯•..."
npm run test

# ä»£ç æ£€æŸ¥
echo "ä»£ç æ£€æŸ¥..."
npm run lint

# æ„å»ºé¡¹ç›®
echo "æ„å»ºé¡¹ç›®..."
npm run build:mp-weixin

# ä¸Šä¼ åˆ°å¾®ä¿¡å°ç¨‹åº
echo "ä¸Šä¼ åˆ°å¾®ä¿¡å°ç¨‹åº..."
# ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·å‘½ä»¤è¡Œ
miniprogram-ci upload --project-path ./dist/build/mp-weixin

echo "éƒ¨ç½²å®Œæˆï¼"
```

## ğŸ“ æ–‡æ¡£æ”¹è¿›å»ºè®®

### 1. API æ–‡æ¡£
ä½¿ç”¨ JSDoc æˆ– TypeScript ä¸º API æ·»åŠ è¯¦ç»†æ–‡æ¡£ï¼š

```javascript
/**
 * è·å–é¢˜ç›®åˆ—è¡¨
 * @param {Object} params - æŸ¥è¯¢å‚æ•°
 * @param {string} params.category - é¢˜ç›®åˆ†ç±»
 * @param {number} params.page - é¡µç 
 * @param {number} params.limit - æ¯é¡µæ•°é‡
 * @returns {Promise<{data: Question[], total: number}>} é¢˜ç›®åˆ—è¡¨å’Œæ€»æ•°
 * @throws {Error} å½“ç½‘ç»œè¯·æ±‚å¤±è´¥æ—¶æŠ›å‡ºé”™è¯¯
 * @example
 * const result = await getQuestions({ category: 'javascript', page: 1, limit: 10 })
 * console.log(result.data) // é¢˜ç›®æ•°ç»„
 */
export async function getQuestions(params) {
  // å®ç°é€»è¾‘
}
```

### 2. ç»„ä»¶æ–‡æ¡£
ä¸ºæ¯ä¸ªç»„ä»¶æ·»åŠ ä½¿ç”¨è¯´æ˜ï¼š

```vue
<!--
@component QuestionCard
@description é¢˜ç›®å¡ç‰‡ç»„ä»¶ï¼Œç”¨äºæ˜¾ç¤ºå•ä¸ªé¢˜ç›®å’Œé€‰é¡¹
@example
<QuestionCard 
  :question="questionData" 
  @answer-selected="handleAnswerSelected"
/>
-->
<template>
  <!-- ç»„ä»¶æ¨¡æ¿ -->
</template>
```

## ğŸ¯ æ€»ç»“

é€šè¿‡ä»¥ä¸Šæ”¹è¿›å»ºè®®ï¼Œå¯ä»¥æ˜¾è‘—æå‡é¡¹ç›®çš„ï¼š

1. **ä»£ç è´¨é‡**ï¼šé€šè¿‡ ESLintã€Prettier å’Œ TypeScript æå‡ä»£ç è§„èŒƒ
2. **å¯ç»´æŠ¤æ€§**ï¼šé€šè¿‡æ¨¡å—åŒ–ã€ç»„ä»¶åŒ–å’Œæ–‡æ¡£åŒ–æå‡ç»´æŠ¤æ•ˆç‡
3. **æ€§èƒ½**ï¼šé€šè¿‡ä»£ç åˆ†å‰²ã€å›¾ç‰‡ä¼˜åŒ–å’Œç¼“å­˜ç­–ç•¥æå‡ç”¨æˆ·ä½“éªŒ
4. **å®‰å…¨æ€§**ï¼šé€šè¿‡è¾“å…¥éªŒè¯ã€æ•°æ®åŠ å¯†å’Œé”™è¯¯å¤„ç†æå‡å®‰å…¨æ€§
5. **å¯æµ‹è¯•æ€§**ï¼šé€šè¿‡å•å…ƒæµ‹è¯•å’Œ E2E æµ‹è¯•ä¿è¯ä»£ç è´¨é‡
6. **å¯ç›‘æ§æ€§**ï¼šé€šè¿‡æ€§èƒ½ç›‘æ§å’Œé”™è¯¯ä¸ŠæŠ¥åŠæ—¶å‘ç°é—®é¢˜

å»ºè®®æŒ‰ä¼˜å…ˆçº§é€æ­¥å®æ–½è¿™äº›æ”¹è¿›ï¼Œä¼˜å…ˆè§£å†³å½“å‰çš„è­¦å‘Šå’Œé”™è¯¯ï¼Œç„¶åé€æ­¥å®Œå–„ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚
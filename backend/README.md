# æŒä¸Šåˆ·é¢˜å® - åç«¯æœåŠ¡å™¨

åŸºäº Node.js + Express + MySQL çš„åç«¯APIæœåŠ¡å™¨ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” ç”¨æˆ·è®¤è¯ï¼ˆæ³¨å†Œã€ç™»å½•ã€JWTï¼‰
- ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯ç®¡ç†ï¼ˆèµ„æ–™ç¼–è¾‘ã€å¯†ç ä¿®æ”¹ï¼‰
- ğŸ“Š å­¦ä¹ ç»Ÿè®¡ï¼ˆç­”é¢˜è®°å½•ã€æ­£ç¡®ç‡ã€ç§¯åˆ†ï¼‰
- ğŸ“ é¢˜ç›®ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ã€åˆ†ç±»ç­›é€‰ï¼‰
- ğŸ¯ ç»ƒä¹ æ¨¡å¼ï¼ˆéšæœºé¢˜ç›®ã€éš¾åº¦é€‰æ‹©ï¼‰
- ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤ï¼ˆå¯†ç åŠ å¯†ã€è¯·æ±‚é™åˆ¶ï¼‰

## æŠ€æœ¯æ ˆ

- **è¿è¡Œç¯å¢ƒ**: Node.js 16+
- **Webæ¡†æ¶**: Express.js
- **æ•°æ®åº“**: MySQL 8.0+
- **è®¤è¯**: JWT (JSON Web Token)
- **å¯†ç åŠ å¯†**: bcryptjs
- **ç¯å¢ƒé…ç½®**: dotenv
- **å®‰å…¨ä¸­é—´ä»¶**: helmet, cors, express-rate-limit

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd backend
npm install
```

### 2. ç¯å¢ƒé…ç½®

å¤åˆ¶ `.env` æ–‡ä»¶å¹¶æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹é…ç½®ï¼š

```bash
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=1145
DB_NAME=zhangshang_shuati

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=development

# JWTå¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒè¯·ä¿®æ”¹ï¼‰
JWT_SECRET=your_jwt_secret_key_here_change_in_production
JWT_EXPIRES_IN=7d
```

### 3. æ•°æ®åº“å‡†å¤‡

ç¡®ä¿MySQLæœåŠ¡å·²å¯åŠ¨ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨ï¼š
- åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- åˆ›å»ºæ‰€éœ€çš„æ•°æ®è¡¨
- æ’å…¥ç¤ºä¾‹é¢˜ç›®æ•°æ®

### 4. å¯åŠ¨æœåŠ¡å™¨

```bash
# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

æœåŠ¡å™¨å¯åŠ¨åè®¿é—®ï¼šhttp://localhost:3000

## API æ¥å£æ–‡æ¡£

### è®¤è¯æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/api/v1/auth/register` | ç”¨æˆ·æ³¨å†Œ | âŒ |
| POST | `/api/v1/auth/login` | ç”¨æˆ·ç™»å½• | âŒ |
| GET | `/api/v1/auth/verify` | éªŒè¯token | âœ… |
| POST | `/api/v1/auth/logout` | ç”¨æˆ·ç™»å‡º | âœ… |

### ç”¨æˆ·æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/api/v1/user/profile` | è·å–ç”¨æˆ·ä¿¡æ¯ | âœ… |
| PUT | `/api/v1/user/profile` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | âœ… |
| PUT | `/api/v1/user/password` | ä¿®æ”¹å¯†ç  | âœ… |
| GET | `/api/v1/user/stats` | è·å–å­¦ä¹ ç»Ÿè®¡ | âœ… |

### é¢˜ç›®æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| GET | `/api/v1/question/list` | è·å–é¢˜ç›®åˆ—è¡¨ | âŒ |
| GET | `/api/v1/question/:id` | è·å–é¢˜ç›®è¯¦æƒ… | âŒ |
| POST | `/api/v1/question/:id/answer` | æäº¤ç­”æ¡ˆ | âœ… |
| GET | `/api/v1/question/random/practice` | éšæœºç»ƒä¹ é¢˜ç›® | âŒ |
| GET | `/api/v1/question/stats/categories` | é¢˜ç›®åˆ†ç±»ç»Ÿè®¡ | âŒ |

## æ•°æ®åº“ç»“æ„

### ç”¨æˆ·è¡¨ (users)
- id: ç”¨æˆ·ID
- username: ç”¨æˆ·å
- email: é‚®ç®±
- password: å¯†ç ï¼ˆåŠ å¯†ï¼‰
- nickname: æ˜µç§°
- avatar: å¤´åƒ
- gender: æ€§åˆ«
- birthday: ç”Ÿæ—¥
- bio: ä¸ªäººç®€ä»‹
- learning_goal: å­¦ä¹ ç›®æ ‡
- level: ç­‰çº§
- points: ç§¯åˆ†

### ç”¨æˆ·ç»Ÿè®¡è¡¨ (user_stats)
- user_id: ç”¨æˆ·ID
- correct_rate: æ­£ç¡®ç‡
- continuous_days: è¿ç»­å­¦ä¹ å¤©æ•°
- total_questions: æ€»ç­”é¢˜æ•°
- correct_questions: æ­£ç¡®ç­”é¢˜æ•°
- rank_position: æ’å

### é¢˜ç›®è¡¨ (questions)
- id: é¢˜ç›®ID
- title: é¢˜ç›®æ ‡é¢˜
- content: é¢˜ç›®å†…å®¹
- type: é¢˜ç›®ç±»å‹ï¼ˆsingle/multiple/judgeï¼‰
- options: é€‰é¡¹ï¼ˆJSONï¼‰
- correct_answer: æ­£ç¡®ç­”æ¡ˆ
- explanation: è§£æ
- difficulty: éš¾åº¦ï¼ˆeasy/medium/hardï¼‰
- category: åˆ†ç±»
- tags: æ ‡ç­¾ï¼ˆJSONï¼‰

### ç­”é¢˜è®°å½•è¡¨ (user_answers)
- user_id: ç”¨æˆ·ID
- question_id: é¢˜ç›®ID
- user_answer: ç”¨æˆ·ç­”æ¡ˆ
- is_correct: æ˜¯å¦æ­£ç¡®
- answer_time: ç­”é¢˜æ—¶é—´

## å¼€å‘è¯´æ˜

### é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ database.js          # æ•°æ®åº“é…ç½®
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth.js              # è®¤è¯ä¸­é—´ä»¶
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ auth.js              # è®¤è¯è·¯ç”±
â”‚   â”œâ”€â”€ user.js              # ç”¨æˆ·è·¯ç”±
â”‚   â””â”€â”€ question.js          # é¢˜ç›®è·¯ç”±
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ init-data.js         # æ•°æ®åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ .env                     # ç¯å¢ƒé…ç½®
â”œâ”€â”€ package.json             # é¡¹ç›®é…ç½®
â”œâ”€â”€ server.js                # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â””â”€â”€ README.md                # è¯´æ˜æ–‡æ¡£
```

### å®‰å…¨ç‰¹æ€§

- **å¯†ç åŠ å¯†**: ä½¿ç”¨ bcryptjs è¿›è¡Œå¯†ç å“ˆå¸Œ
- **JWTè®¤è¯**: æ— çŠ¶æ€çš„ç”¨æˆ·è®¤è¯
- **è¯·æ±‚é™åˆ¶**: é˜²æ­¢APIæ»¥ç”¨
- **CORSé…ç½®**: è·¨åŸŸè¯·æ±‚æ§åˆ¶
- **Helmet**: è®¾ç½®å®‰å…¨HTTPå¤´
- **è¾“å…¥éªŒè¯**: é˜²æ­¢SQLæ³¨å…¥ç­‰æ”»å‡»

### ç¯å¢ƒè¦æ±‚

- Node.js 16.0+
- MySQL 8.0+
- npm æˆ– yarn

## éƒ¨ç½²è¯´æ˜

### ç”Ÿäº§ç¯å¢ƒé…ç½®

1. ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„é…ç½®
2. è®¾ç½®å¼ºå¯†ç çš„ `JWT_SECRET`
3. é…ç½®ç”Ÿäº§æ•°æ®åº“
4. ä½¿ç”¨ PM2 æˆ–å…¶ä»–è¿›ç¨‹ç®¡ç†å™¨

### PM2 éƒ¨ç½²ç¤ºä¾‹

```bash
# å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨åº”ç”¨
pm2 start server.js --name "shuati-backend"

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥MySQLæœåŠ¡æ˜¯å¦å¯åŠ¨
   - éªŒè¯æ•°æ®åº“é…ç½®ä¿¡æ¯
   - ç¡®è®¤ç½‘ç»œè¿æ¥

2. **JWTéªŒè¯å¤±è´¥**
   - æ£€æŸ¥JWT_SECRETé…ç½®
   - ç¡®è®¤tokenæ ¼å¼æ­£ç¡®
   - éªŒè¯tokenæ˜¯å¦è¿‡æœŸ

3. **ç«¯å£å ç”¨**
   - ä¿®æ”¹ `.env` ä¸­çš„ PORT é…ç½®
   - æˆ–åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## è®¸å¯è¯

MIT License